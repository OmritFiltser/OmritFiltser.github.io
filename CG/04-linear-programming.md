# תכנון ליניארי וחיתוך של חצאי מישורים {#linear-prog}

## הקדמה {#preface}

### בעיית הייצור באמצעות תבניות {#molding-prob}

<img src="images/4/molding-casting.jpg" align="left" width="33%"/> חפצים רבים שאנו משתמשים בהם באופן יום-יומי מיוצרים בתהליך אוטומטי, שבו יוצקים נוזל לתבנית רב פעמית, ולאחר שהוא מתמצק שולפים אותו החוצה מבלי לפגוע בתבנית. כמובן שלא כל צורה תלת מימדית ניתנת לייצור באופן הזה, למשל צורה שהיא כדורית. נניח שנתון לנו **פוליהדרון** (גוף תלת מימדי המורכב מפאות שהן פוליגונים, צלעות שהן קוים ישרים, וקודקודים שהם נקודות), איך נדע האם ניתן לייצר אותו על ידי יציקה לתבנית רב פעמית?

#### קראו את ההקדמה לפרק 4 (עמודים 63-64). {.unnumbered}

### מודל גאומטרי לבעיה {#geom-model}

<img src="images/4/mold.jpg" align="left" width="25%"/> בהינתן פוליהדרון $P$ בעל $n$ פאות שהן פוליגונים, נרצה לתכנן תבנית שתאפשר לנו לייצר את $P$. כדי שנוכל לחלץ את $P$ מהתבנית על ידי משיכה בכיוון אחד, נדרוש שבדיוק אחת מהפאות של $P$ תהיה מוכלת בפאה העליונה של התבנית. התבנית חייבת להתאים לצורה של $P$, אבל את הפאה העליונה נוכל לבחור מתוך $n$ הפאות של $P$, ולכן יש לכל היותר $n$ תבניות אפשרויות. כמובן שלא כל תבנית תאפשר לנו לחלץ את $P$.

::: rmdwarning
<img src="images/question.png" align="right" width="10%" style="padding:0px 0px 0px 10px"/> בדיקת שפיות! ענו על השאלה הבאה: באילו מהתבניות הבאות ניתן לחלץ את הפוליהדרון שיצקו בהן על ידי משיכה בכיוון אחד?

(לשם הפשטות, האיורים מציגים חתך עומק של התבנית והפוליהדרון בדו-מימד. הניחו שכל חתכי העומק של הפוליהדרון זהים לזה שבאיור.)

<img src="images/4/mold1.jpg" width="20%"/> <img src="images/4/mold2.jpg" width="20%"/> <img src="images/4/mold3.jpg" width="20%"/> <img src="images/4/mold4.jpg" width="20%"/> <img src="images/4/mold5.jpg" width="20%"/>

<details>

<summary>(פתרון)</summary>
שלושת התבניות הראשונות משמאל.

</details>
:::

אובייקט שניתן לייצור על ידי יציקה לתבנית רב פעמית נקרא castable. כדי לבדוק האם $P$ הוא castable, נבדוק את כל האפשרויות לתבנית עבורו. בהינתן אחת מהאפשרויות האלה (כלומר, בהינתן הפאה של $P$ שתהיה מוכלת בפאה העליונה של התבנית), נרצה לקבוע האם קיים כיוון (וקטור) $\overrightarrow{d}$ כך שניתן לשלוף את $P$ מהתבנית על ידי משיכה בכיוון $\overrightarrow{d}$.

<img src="images/4/angle.jpg" align="left" width="33%"/> שימו לב שלכל פאה $f$ של $P$ שהיא לא הפאה העליונה, יש פאה מתאימה $\hat{f}$ בתבנית. באופן אינטואיטיבי, כדי שנוכל להוציא את $P$ מהתבנית, כל פאה $f$ של $P$ צריכה לנוע בכיוון שהוא "נגדי" או לכל היותר "מאונך" ל-$\hat{f}$. באופן פורמלי, נוכל להסתכל על הנורמל (כלפי חוץ מהפוליגון) של פאה $f$, נסמן אותו $\overrightarrow{\mu}( f )$. הנורמל של $f$ הוא וקטור המאונך למישור המכיל את $f$. נוכל להראות שהפאה המתאימה $\hat{f}$ של התבנית, מאפשרת תנועה רק בכיוון $\overrightarrow{d}$ שבו הזווית (הקטנה) שנוצרת בין $\overrightarrow{d}$ ל-$\overrightarrow{\mu}( f )$ היא לפחות $90 ^\circ$.

הטענה הזו מובילה להגדרת הבעיה באופן הבא: יש למצוא כיוון $\overrightarrow{d}$ כך שהזוית שלו עם הנורמלים של כל אחת מהפאות של $P$ היא לפחות $90 ^\circ$. כל פאה של P בעצם מהווה אילוץ על הכיוון $\overrightarrow{d}$. כל אילוץ כזה ניתן לתאר ע"י משוואה לינארית: הזוית בין $\overrightarrow{d}$ ל-$\overrightarrow{\mu}( f )$ גדולה או שווה ל-$90 ^\circ$ אם ורק אם $\overrightarrow{d} \cdot \overrightarrow{\mu}( f ) \le 0$. נוכל לייצג את $\overrightarrow{d}$ על ידי נקודה במישור $z = 1$, כלומר, $\overrightarrow{d}$ יהיה הוקטור $(x,y,1)$ מתחיל בראשית הצירים ומסתיים בנקודה $(x, y, 1 )$. לכן עבור $\overrightarrow{\mu}( f ) =( \mu_x, \mu_y, \mu_z )$ נקבל אילוץ שהוא בעצם משוואה של חצי מישור: $\mu_x \cdot x + \mu_y \cdot y + \mu_z \le 0$.

המשמעות היא שקיים כיוון $\overrightarrow{d}$ המאפשר לשלוף את $P$ מהתבנית, אם ורק אם קיימת נקודה $( x, y )$ המקיימת כל כל האילוצים, כלומר, נקודה שנמצאת בחיתוך של אוסף חצאי המישורים המתאימים להם. בעצם המרנו את הבעיה המקורית לבעיה גאומטרית במישור: בהינתן אוסף של n חצאי מישורים, יש למצוא נקודה בחיתוך שלהם, אם החיתוך לא ריק. בהמשך נראה כיצד ניתן לפתור את הבעיה הזו בזמן צפוי $O ( n )$, ולכן נוכל לפתור את בעיית הייצור באמצעות תבניות בזמן צפוי $O ( n^2 )$.

#### קראו את סעיף 4.1 בספר (עמודים 64-66). {.unnumbered}

<hr class="mt-5 mb-5"/>

## חיתוך של חצאי מישורים {#line-int}

### אלגוריתם בשיטת הפרד ומשול {#div-con-alg}

בחלק הקודם ראינו כיצד ניתן להמיר את הבעיה של ייצור באמצעות תבניות לבעיה של מציאת נקודה כלשהי המספקת אוסף של אילוצים לינאריים בשני משתנים, או לחילופין, לבעיה הגאומטרית של מציאת נקודה כלשהי בחיתוך של אוסף חצאי מישורים. החיתוך של אוסף חצאי מישורים הוא תחום קמור, אך הוא אינו חייב להיות חסום. הנה דוגמה לתחום קמור שאינו חסום (מימין), ותחום קמור חסום (משמאל).

<p align="center" width="100%">

<img src="images/4/bounded_and_unbounded.jpg" width="70%"/>

</p>

לפני שנדבר על הבעיה של מציאת נקודה כלשהי בחיתוך, נראה קודם כיצד ניתן למצוא את קבוצת כל הנקודות בחיתוך. בחלקו הראשון של סעיף 4.2 בספר הלימוד תקראו על אלגוריתם IntersectHalfPlanes, המקבל כקלט אוסף $H$ של חצאי מישורים, ומחשב את התחום הקמור שהוא החיתוך שלהם. זהו אלגוריתם הפועל בשיטת הפרד ומשול: הוא מחלק את הקבוצה $H$ באופן שרירותי לשתי קבוצות, מחשב את החיתוך של כל אחת מהן באופן רקורסיבי, ולאחר מכן מחשב את החיתוך של שני התחומים הקמורים שהתקבלו בעזרת פרוצדורה נוספת בשם IntesectConvexRegions.

את אלגוריתם IntersectConvexRegions לחישוב החיתוך בין תחומים קמורים נתאר בהמשך החלק הזה.

#### קראו את חלקו הראשון של סעיף 4.2 בספר הלימוד (עמודים 66--68). {.unnumbered}

### חיתוך של פוליגונים קמורים {#convex-int}

בחלק השלישי של יחידה 2 (המדבר על פעולות בוליאניות), ראינו שניתן לחשב את החיתוך של שני פוליגונים (לא בהכרח קמורים) בזמן O ( ( n + k ) log n ), כאשר k הוא מספר נקודות חיתוך, בעזרת האלגוריתם MapOverlay.

::: rmdwarning
<img src="images/question.png" align="right" width="10%" style="padding:0px 0px 0px 10px"/> <img src="images/4/question.jpg" align="left" width="30%"/> מהו המספר המקסימלי האפשרי של נקודות חיתוך בין צלעות של שני פוליגונים קמורים בעלי $n$ קודקודים כל אחד? נסו לצייר שני פוליגונים קמורים עם מספר מקסימלי של נקודות חיתוך.

<details>

<summary>(פתרון)</summary>

המספר המקסימלי האפשרי של נקודות חיתוך בין שני פוליגונים קמורים $C_1$ ו-$C_2$ בעלי
$n$ נקודות כל אחד, הוא
$2 n$. הסיבה היא שכל צלע $e$ של $C_1$ יכולה להחתך עם לכל היותר שתי צלעות של $C_2$: אם $e$ היתה נחתכת עם יותר משתי צלעות של $C_2$, אז $C_2$ לא היה יכול להיות קמור.

<p align="center" width="100%">

<img src="images/4/convex_intersection.jpg" width="40%"/>

</p>

הנה דוגמה למשפחה של זוגות פוליגונים קמורים $C_1$ ו-$C_2$ כך שכל צלע של $C_1$ נחתכת עם בדיוק שתי צלעות של $C_2$: אלו זוגות של פוליגונים משוכללים בעלי $n$ צלעות המסובבים בזוית שונה שונה סביב המרכז.

<p align="center" width="100%">

<img src="images/4/max_convex_intersection.jpg" width="70%"/>

</p>

</details>
:::

אם נשתמש באלגוריתם MapOverlay עבור מציאת החיתוך בין פוליגונים קמורים, זמן הריצה יהיה $O ( n \log n )$, כי כמו שראינו בשאלה למעלה, $k \le 2 n$. לכן, לפי שיטת האב (Master Theorem), זמן הריצה הכולל עבור אלגוריתם IntersectHalfPlanes יהיה $O ( n \log^2 n )$. האם בכל זאת ניתן לחשב את החיתוך באופן יעיל יותר עבור תחומים קמורים? התשובה היא כן! (זכרו שתמיד נשאף לזמן ריצה לינארי, או $O ( n \log n )$...)

אלגוריתם MapOverlay משתמש בשיטת הישר הסורק, ולזמן הריצה שלו יש שני גורמים. הגורם הראשון הוא $( n + k )$ -- מספר המאורעות. הגורם השני הוא $\log n$ -- הזמן לטיפול במאורע, כלומר, עדכון הסטטוס (שיכול להכיל $O ( n )$ קטעים), והוספת מאורע לתור המאורעות בכל פעם שמצאנו נקודת חיתוך. אך האם זהו המצב גם עבור פוליגונים קמורים?

למעשה, עבור פוליגונים קמורים יהיו לכל היותר 4 צלעות שחותכות את הישר הסורק בכל רגע נתון. נוכל לראות זאת אם נחלק כל פוליגון לשרשרת ימנית ושרשרת שמאלית (מהקודקד הגבוה ביותר לקודקוד הנמוך ביותר). כל שרשרת כזאת היא $y$-מונוטונית, ולכן חותכת את הישר הסורק (האופקי) פעם אחת בלבד.

<p align="center" width="100%">

<img src="images/4/convex_intersection_left_right.jpg" width="70%"/>

</p>

עובדה זו מובילה לכך שהטיפול בכל מאורע יתבצע בזמן קבוע, וכבר לא יהיה לנו צורך במאורעות שהם נקודות חיתוך. באופן זה נקבל אלגוריתם למציאת חיתוך של פוליגונים קמורים עם זמן ריצה של $O ( n )$ בלבד, ובכך נשפר את זמן הריצה עבור חיתוך חצאי מישורים ל-$O ( n \log n )$.

#### קראו את חלקו השני של סעיף 4.2 בספר הלימוד (עמודים 71--68). {.unnumbered}

<hr class="mt-5 mb-5"/>

## תכנון לינארי במישור {#planar-LP}

### מהו תכנון לינארי? {#what-is-LP}

תכנון לינארי היא בעיית אופטימיזציה של ביטוי לינארי, תחת אוסף של אילוצים לינאריים. זוהי בעייה מרכזית בתחום של חקר ביצועים, שבו בעיות אופטימיזציה רבות ניתנות לתאור באמצעות תוכנית לינארית. הבעיה צברה פופולריות רבה משום שהיא שימושית בתחומים רבים נוספים, ולכן במשך השנים נעשו מאמצים רבים למציאת פתרונות יעילים ומהירים עבורה. בסרטון הבא נראה דוגמה לתוכנית כזאת, נזכיר חלק מהכלים הקיימים כיום לפתרון בעיות תכנון לינארי, ונדבר על הקשר בין תכנון לינארי במישור לבעיית החיתוך של חצאי מישורים.

#### צפו בסרטון הבא: {.unnumbered}

<iframe width="560" height="315" src="https://www.youtube.com/embed/r5vnvtTYiEY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen>

</iframe>

#### קראו את חלקו הראשון של סעיף 4.3 בספר הלימוד (עמודים 71--72). {.unnumbered}

### אלגוריתם אינקרמנטלי {#inc-alg}

בחלקו השני של סעיף 4.3 בספר הלימוד מתואר אלגוריתם אינקרמנטלי בשם 2DBoundedLP, לפתרון של תוכנית לינארית בשני מימדים. האלגוריתם פועל תחת ההנחה שהתוכנית הלינארית חסומה. לכן, בשלב הזה נניח כי ניתן למצוא ולהוסיף לתוכנית הלינארית שני חצאי מישורים $m_1, m_2$, שיגרמו לכך שהתוכנית תהיה חסומה בכיוון $\overrightarrow{c}$, אך לא ישנו את הפתרון האופטימלי במקרה שבו התוכנית חסומה. בהמשך נראה כיצד להימנע מהנחה זו ולקבוע מראש האם התוכנית חסומה או לא.

האלגוריתם האינקרמנטלי מתחיל מפתרון עבור $C_0 = m_1 \cap m_2$, ואז מוסיף את יתר חצאי המישורים $h_1, \dots, h_n$ לפי הסדר. בשלב ה-$i$, האלגוריתם ימצא קודקוד v_i שהוא הנקודה שממקסמת את פונקציית המטרה בחיתוך $C_i = m_1 \cap m_2 \cap h_1 \cap h_2 \cap \dots \cap h_i$. הרעיון הוא שבכל שלב מצמצמים את התחום הפיזיבילי, ויש שתי אפשרויות עבור $v_i$:

אם $v_{i-1}\in h_i$ (כמו באיור הימני למטה), אז $h_i$ לא שינה את הפתרון האופטימלי ולכן $v_i = v_{i-1}$. אחרת, $h_i$ גרם לכך ש-$C_i$ כבר לא כולל את $v_{i-1}$ (כמו באיור השמאלי למטה). בספר תראו הוכחה לכך שבמקרה זה, אם $C_i$ לא ריק, אז $v_i$ בהכרח נמצא על הישר $\ell_i$ המגדיר את חצי המישור $h_i$.

<p align="center" width="100%">

<img src="images/4/incremental_case1.jpg" width="40%"/> <img src="images/4/incremental_case2.jpg" width="40%"/>

</p>

באופן די מאכזב, זמן הריצה המתקבל מאלגוריתם זה הוא $O(n^2)$, מכיון שבמקרה השני נצטרך לחשב את החיתוך של $\ell_i$ עם חצאי המישורים $m_1, m_2, h_1, \dots, h_{i-1}$. לכן, במקרה הגרוע, זמן הריצה עבור השלב ה-$i$ יהיה $O(i)$.

::: rmdwarning
<img src="images/question.png" align="right" width="10%" style="padding:0px 0px 0px 10px"/> כמה פעמים יתעדכן הפתרון? נסו לחשוב על המקרה הגרוע ביותר: כמה פעמים לכל היותר יכול לקרות המקרה השני, בו נצטרך לעדכן את $v_i$ בזמן $O(i)$?

(התשובה נמצאת בפסקה האחרונה של סעיף 4.3 בספר הלימוד)
:::

בהמשך נראה כיצד בחירה רנדומית של הסדר בו מוסיף האלגוריתם את חצאי המישורים, מובילה לתוחלת זמן ריצה לינארית.

#### קראו את חלקו השני של סעיף 4.3 בספר הלימוד (עמודים 73--76). {.unnumbered}

### אלגוריתם רנדומי {#rand-alg}

כמו שהובטח בחלקים הקודמים, תכנון לינארי במישור אכן ניתן לפיתרון בזמן צפוי של $O( n )$, על ידי האלגוריתם
2DRandomizedBoundedLP אותו נציג בחלק זה. זהו כמובן אלגוריתם רנדומי, והוא זהה כמעט לחלוטין לאלגוריתם האינקרמטלי שהוצג בסעיף הקודם: ההבדל היחידי הוא בשורה השנייה של האלגוריתם, שם מחשבים פרמוטציה אקראית של חצאי המישורים בעזרת פרוצדורה בשם RandomPermutation.

בסרטון הבא נראה כיצד שינוי זה, שנראה לכאורה כאילו אינו משפיע על האלגוריתם, מוביל לתופעה מעניינת ביותר: תוחלת זמן ריצה תהיה לינארית. כלומר, כאשר מגרילים את הסדר בו האלגוריתם האינקמנטלי בוחן את חצאי המישורים, מקבלים שבממוצע על פני כל הפרמוטציות האפשריות, זמן הריצה הוא $O( n )$.

#### צפו בסרטון הבא: {.unnumbered}

<iframe width="560" height="315" src="https://www.youtube.com/embed/f8OanQaN_D0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen>

</iframe>

#### קראו את סעיף 4.3 בספר הלימוד (עמודים 66--68). {.unnumbered}

### תוכנית לינארית שאינה חסומה {#unbounded-LP}

בסעיפים הקודמים נמנענו מהטיפול במקרה בו התוכנית הלינארית אינה חסומה, על ידי הוספת שני אילוצים מלאכותיים, $m_1,m_2$. בחלק זה נראה כיצד ניתן לבדוק האם תוכנית לינארית היא חסומה, ואם היא לא חסומה, נראה כיצד למצוא שני אילוצים $h_1,h_2$ שישמשו אותנו לאתחול האלגוריתם במקום $m_1,m_2$.

אם התוכנית הלינארית אינה חסומה, אז קיימת קרן $\rho$ המוכלת כולה באיזור הפיזיבילי $C$. הקרן הזו מוגדרת על ידי נקודה p וכיוון $\overrightarrow{d}$. נשים לב שפונקציית המטרה מקבלת ערכים הולכים וגדלים לאורך הקרן rho אם ורק אם הזווית הקטנה בין הוקטור $\overrightarrow{d}$ לוקטור המטרה $\overrightarrow{c}$ קטנה מ-$90 ^\circ$. בנוסף, לכל חצי מישור $h$, הזוית בין $\overrightarrow{d}$ לנורמל $\overrightarrow{\mu}( h )$ של h (בכיוון הצד הפיזיבילי) היא לכל היותר . ניתן לראות דוגמה לכך בציור מטה. נוסף לכך, אוסף האילוצים עבורם $\overrightarrow{\mu}( h )$ בדיוק מאונך ל-$\overrightarrow{d}$ ($h_1, h_5$ באיור), חייב להיות פיזיבילי.

<p align="center" width="100%">

<img src="images/4/unboundedLP.jpg" width="40%"/>

</p>

שימו לב שהבעיה של מציאת הקרן $\rho$ דומה לבעיית הייצור באמצעות תבניות שראינו בחלק הראשון של יחידה זו. מכיוון שכאן הבעיה מוגדרת בשני מימדים, נוכל לפתור אותה על ידי תכנון לינארי במימד אחד, בזמן $O( n )$. בסעיף 4.5 של ספר תוכלו לקרוא תיאור מפורט של פתרון זה.

#### קראו את סעיף 4.4 בספר הלימוד (עמודים 79--82). {.unnumbered}

::: rmdnote
**פתרון אלטרנטיבי**:

<img src="images/4/unbounded-alg-1.jpg" align="left" width="33%"/> דרך אחרת למציאת הקרן $\rho$, היא להתבונן בחצי המישור $h_i$ עבורו הזווית הקטנה בין $\overrightarrow{c}$ ל-$\overrightarrow{\mu}( h_i )$ היא הגדולה ביותר.

&nbsp;  
&nbsp;  

<img src="images/4/unbounded-alg-2.jpg" align="left" width="33%"/> החיתוך בין הישר לבין חצי מישור אחר $h_j$ הוא קרן $\rho$ על . אם לכל $j \neq i$ הזוית הקטנה בין הקרן $\rho$ שמוגדרת על ידי $\ell_1 \cap h_j$ לבין $\overrightarrow{c}$ קטנה או שווה ל-, אז הקרן שראשיתה בנקודה הקיצונית ביותר בכיוון $\overrightarrow{c}$ היא העדות לכך ש-C אינו חסום ביחס ל-$\overrightarrow{c}$.

<img src="images/4/unbounded-alg-3.jpg" align="left" width="33%"/> אחרת, אם עבור $h_j$ כלשהו הזוית הקטנה בין $\rho$ ל-$\overrightarrow{c}$ גדולה מ-, אז חצאי המישורים $h_i$ ו-$h_j$ הם ההוכחה לכך ש-$C$ חסום ביחס ל-$\overrightarrow{c}$. הסיבה לכך היא שהזווית בין $\overrightarrow{c}$ ל-$\overrightarrow{\mu}( h_j )$ קטנה יותר מהזווית בין $\overrightarrow{c}$ ל-$\overrightarrow{\mu}( h_i )$, ולכן הזוית בין $h_j$ ל-$\overrightarrow{c}$ גדולה מ-$90^\circ$.
&nbsp;  

:::
