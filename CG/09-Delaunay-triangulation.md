# שילושי דלוני {#Delaunay-triangulation}

## הקדמה {#preface-9}

### אינטרפולציה של גבהים {#terrains}

<img src="images/9/terrain.jpg" align="left" width="55%"/> ייצוג תלת מימדי של פני שטח (terrain) נעשה בדרך כלל על ידי לקיחה דגימות של גובה בנקודות מסויימות, ואז קביעת הגובה בנקודות שלא נמדדו על ידי אינטרפולציה כלשהי של נקודות הדגימה. הדרך המקובלת לעשות זאת היא בעזרת שילוש של קבוצת הנקודות, כלומר, חלוקה של המישור למשולשים שקודקודיהם הם נקודות הדגימה. הגובה של נקודה $q$ שלא נמדדה יתקבל באופן הבא: נמצא את המשולש $\triangle abc$ שהנקודה $q$ נמצאת בתוכו. הנקודות $a,b,c$ עם מדידות הגובה שלהן הן נקודות תלת מימדיות, ולכן מגדירות מישור בתלת מימד. נטיל את $q$ על המישור הזה, וקוארדינטת ה-$z$ שהתקבלה תהיה הגובה של $q$.

לא כל השילושים יראו לנו "טובים" או "טבעיים" באותה המידה. התבוננו למשל בשני השילושים באיור למטה. אלו שני שילושים שונים של אותה קבוצת נקודות, יחד עם הגבהים המתאימים להן. איזה מהשילושים סביר שיתאר את המציאות באופן מהימן יותר?

<center>![](images/9/good_triangulation.jpg){width="80%"}</center>

ביחידה זו ננסה להבין כיצד להגדיר שילוש שמשקף את התפיסה האינטואיביטיבית שלנו לגבי מהו שילוש "טוב", וכן איך ניתן לחשב שילוש כזה.

#### קראו את ההקדמה לפרק 9 בספר הלימוד (עמודים 191־193). {.unnumbered}

------------------------------------------------------------------------

## שילוש של קבוצת נקודות במישור {#point-set-triangulation}

### מהו שילוש של קבוצת נקודות?

ביחידה 3 של הקורס דיברנו על שילוש של פוליגונים - חלוקה של פוליגון למשלושים על ידי מספר מקסימלי של אלכסונים שאינם נחתכים. ביחידה זו, נעסוק בשילושים של קבוצות של נקודות במישור. לשם כך נגדיר קודם את המושג של מפה מישורית מקסימלית (יחידה 2 של הקורס עוסקת במפות מישוריות שאינן בהכרח מקסימליות).

::: rmdimportant
<img src="images/definition.png" align="left" width="10%" style="padding:0px 0px 0px 10px"/> [**הגדרה**: מפה מישורית מקסימלית]{.underline}\
מפה מישורית מקסימלית היא מפה מישורית שלא ניתן להוסיף לה צלעות - כלומר כל צלע שנוסיף בין שני קודקודים תחתוך צלע אחרת.
:::

::: rmdimportant
<img src="images/definition.png" align="left" width="10%" style="padding:0px 0px 0px 10px"/> [**הגדרה**: שילוש של קבוצת נקודות במישור]{.underline}\
בהינתן קבוצה $P$ של $n$ נקודות במישור, שילוש של $P$ הוא חלוקה מישורית מקסימלית שהקודקודים שלה הם נקודות $P$.
:::

שימו לב, יתכן שקיים יותר משילוש אחד לקבוצה נתונה של נקודות!

::: rmdwarning
<img src="images/question.png" align="left" width="10%" style="padding:0px 0px 0px 10px"/> מי מהמפות המישוריות הבאות היא שילוש של קבוצת הנקודות הנתונה?

<center>![](images/9/map_q.jpg){width="100%"}</center>

<details>

<summary>(פתרון)</summary>

שלושת המפות התחתונות בלבד.

</details>
:::

#### תכונות השילוש. {.unnumbered}

שתי תכונות עיקריות:

-   הפאות של מפה מישורית מקסימלית חייבות להיות משולשים: אם יש פאה שהיא לא משולש, אז ניתן לשלש אותה על ידי הוספת אלכסונים - כפי שראינו ביחידה 3 של הקורס.

-   כל צלעות הקמור של $P$ מופיעות בשילוש (והן הצלעות של הפאה הלא חסומה): לא תתכן צלע שיוצאת החוצה מהקמור, ולכן הצלעות של פוליגון הקמור לא יחתכו שום צלע אחרת, וניתן יהיה להוסיף אותן לשילוש.

::: rmdwarning
<img src="images/question.png" align="left" width="10%" style="padding:0px 0px 0px 10px"/> כמה שילושים שונים תוכלו למצוא עבור קבוצת הנקודות הבאה?

<center>![](images/9/triang_q.jpg){width="20%"}</center>

<details>

<summary>(פתרון)</summary>

זיכרו שצלעות הקמור חייבות להיות בשילוש.

<center>![](images/9/triang_ans.jpg){width="80%"}</center>

</details>
:::

#### גודל השילוש. {.unnumbered}

באופן מעניין למדי, לכל השילושים האפשריים של קבוצה $P$ של $n$ נקודות יש גודל זהה, כלומר מספר זהה של משולשים וצלעות. גודל השילוש תלוי במספר הנקודות שמופיעות על השפה של $CH(P)$ (שפת הקמור של $P$).

::: rmdimportant
<img src="images/definition.png" align="left" width="10%" style="padding:0px 0px 0px 10px"/> [**משפט**:]{.underline} תהי $P$ קבוצה של $n$ נקודות במישור, שלא כולן על ישר אחד. נסמן ב-$k$ את מספר הנקודות על השפה של $CH(P)$. אז בכל שילוש של $P$ יש $2n-2-k$ משולשים ו-$3n-3-k$ צלעות.
:::

ההוכחה למשפט מופיעה בסעיף 9.1 בספר הלימוד, והיא משתמשת בנוסחת אוילר, שכבר ראינו מספר פעמים בעבר.

::: rmdwarning
<img src="images/question.png" align="left" width="10%" style="padding:0px 0px 0px 10px"/> לפני שתקראו את ההוכחה המופיעה בספר, נסו להוכיח בעצמכם את המשפט לגבי גודל השילוש.
:::

### כיצד נגדיר שילוש טוב?

#### צפו בסרטון הבא. {.unnumbered}

#### וקטור הזויות. {.unnumbered}

#### שילוש אופטימלי. {.unnumbered}

#### צלעות חוקיות ופעולת ההיפוך. {.unnumbered}

#### משפט תלס. {.unnumbered}

<center>

<iframe src="https://www.desmos.com/calculator/yknwki8nqa?embed" width="100%" height="500" style="border: 1px solid #ccc" frameborder="0">

</iframe>

</center>

#### שילוש חוקי. {.unnumbered}

כל שילוש אופטימלי הוא חוקי

#### קראו את סעיף 9.1 בספר הלימוד (עמודים 193־195). {.unnumbered}

------------------------------------------------------------------------

## השילוש של דלוני

### גרף דלוני

#### צפו בסרטון הבא. {.unnumbered}

#### תכונות של גרף דלוני. {.unnumbered}

### שילוש דלוני

שילוש הוא חוקי אמ"מ הוא דלוני

שילוש אופטימלי הוא חוקי, ולכן הוא דלוני

אם הנקודות במצב כללי - שילוש דלוני הוא יחיד, ולכן יש רק שילוש חוקי אחד, והוא השילוש האופטימלי היחיד.

אם הנקודות לא במצב כללי - עדיין שילוש דלוני הוא חוקי, אבל לא בהכרח אופטימלי. עם זאת, אפשר להראות בעזרת משפט תלס שלכל שילוש דלוני יש אותה זוית מינימלית. לכן לכל השילושים החוקיים יש אותה זוית מינימלי, ובפרט זוהי גם הזוית המינימלית בשילוש אופטימלי. לכן, הזוית המינימלית בשילוש דלוני היא המקסימלית האפשרית על פני כל השילושים של $P$.

#### קראו את סעיף 9.2 בספר הלימוד (עמודים 196־199). {.unnumbered}

### אלגוריתם לבניית שילוש דלוני

ניתן לחשב את שילוש דלוני של קבוצת נקודות $P$ במישור בעזרת דיאגמת וורונוי של $P$:

1.  נחשב את $Vor(P)$.
2.  נבנה את הגרף הדואלי לדיאגרמה (כלומר גרף דלוני).
3.  לבסוף, אם יש פאה בגרף שהיא לא משולש, נשלש אותה (ראינו אלגוריתם לשילוש של פוליגון ביחידה 3 של הקורס).

זמן הריצה הכולל יהיה $O(n\log n)$.

#### אלגוריתם אינקרמנטלי רנדומי. {.unnumbered}

דרך אחרת לחישוב שילוש דלוני היא בעזרת האלגורתם האינקרמנטלי-רנדומי **DelaunayTriangulation** המתואר בסעיף 9.3 של ספר הלימוד.

הרעיון המרכזי באלגוריתם הוא לבנות משולש כלשהו גדול מספיק שמכיל את כל הנקודות של הקבוצה $P$ בפנימו, ואז להוסיף את נקודות $P$ בזו אחר זו בסדר אקראי, ובכל פעם לעדכן את השילוש.

נסמן את נקודות $P$ לפי הסדר האקראי ב-$p_1,p_2,\dots,p_n$, ואת קודקודי המשולש ההתחלתי ב-$p_{-1},p_{-2},p_{-3}$. נניח שחישבנו את שילוש דלוני של $p_{-1},p_{-2},p_{-3},p_1,p_2,\dots,p_{r-1}$, ואנחנו רוצים להוסיף עכשיו את $p_r$. יש שני מקרים:

1.  אם הנקודה $p_r$ נמצאת בפנים של משולש $\triangle p_ip_jp_k$: נוסיף צלעות מ-$p_r$ לכל אחד מקודקודי המשולש.
2.  אם הנקודה $p_r$ נמצאת על צלע $\overline{p_ip_j}$ שמשותפת לשני משולשים, $\triangle p_ip_jp_k$ ו-$\triangle p_ip_jp_l$: נוסיף צלעות מ-$p_r$ לקודקודים $p_k$ ו-$p_l$.

בשני המקרים קיבלנו שילוש, אך זהו לא בהכרח שילוש דלוני. כדי לתקן את השילוש במקרה הצורך, האלגוריתם קורא לפרוצדורה נוספת בשם **LegalizeEdge**, שמקבלת שילוש, את הקודקוד $p_r$, וצלע במשולש שיתכן ויש צורך לבצע פעולת היפוך עבורה. במקרה הראשון למשל, האלגוריתם יקרא לפרוצדורה הזאת עבור כל אחת מצלעות המשולש $\triangle p_ip_jp_k$. אם הצלע אינה חוקית, הפרוצדורה תבצע היפוך שלה, ואז תמשיך לבדוק באופן רקורסיבי את צלעות המשולשים החדשים שנוצרו.

במהלק הקריאה בסעיף 9.3, נסו לענות על השאלות הבאות (כל התשובות מופיעות בספר):

1.  מדוע התהליך הרקורסיבי בשיטה LegalizeEdge הוא סופי?
2.  מדוע הצלעות שמוסיפים מ-$p_r$ לקודקודי המשולש שהוא נמצא בו הן בהכרח צלעות של שילוש דלוני?
3.  כיצד האלגוריתם מוצא את המשולש שמכיל את $p_r$?

#### קראו את סעיף 9.3 בספר הלימוד (עמודים 199־204). {.unnumbered}

קראו עד הפסקה הראשונה בעמוד 204.

#### ניתוח האלגוריתם. {.unnumbered}

ניתוח זמן הריצה של האלגוריתם משתמש בטכניקה שכבר ראינו ביחידות 4 ו-6: אנליזה לאחור. ביחידה זו לא נתעמק בפרטי ההוכחה ונסתפק בציטוט המשפט הבא:

::: rmdimportant
<img src="images/definition.png" align="left" width="10%" style="padding:0px 0px 0px 10px"/> [**משפט**:]{.underline} ניתן לחשב שילוש דלוני של קבוצה $P$ של $n$ נקודות במישור בזמן צפוי $O(n \log n)$, תוך שימוש בזיכרון צפוי $O(n)$.
:::

למעוניינים בכך, ניתן לקרוא את סעיף 9.4 בספר הלימוד, המתאר בפירוט את ניתוח זמן הריצה וסיבוכיות המקום של אלגוריתם DelaunayTriangulation.

## תרגילים נוספים

### ה-MST

### Gabriel Graph

### RNG
