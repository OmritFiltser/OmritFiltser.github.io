# דמיון בין עקומים {#curve-similarity}

## חלק 1: הקדמה {#preface-12}

### מה ביחידה? {#contents-12}

#### דמיון בין עקומים {.unnumbered}
ביחידה זו נלמד חלקים מפרק 30 בספר "Geometric Approximation Algorithms", מאת פרופ' שריאל הר-פלד. ניתן לצפות גם ב
[סדרת ההרצאות הקצרה של Thomas van Dijk](https://www.youtube.com/playlist?list=PLu39BqGd2oyOqo2Fe7OM1GVB0jWyoKOwd). ההרצאות קצרות ותמציתיות ומעבירות את רוב החומר של היחידה בצורה מרתקת.
 

בסיום יחידה זו, תכירו את המושגים ותרכשו את הטכניקות והכלים הבאים:

- מרחק האוסדורף
- מרחק פְרֶשֶׁה (Fréchet), הרציף והדיסקרטי
- דיאגרמת המרחב החופשי (free space diagram)

למידה מהנה!

### כיצד מודדים דמיון בין עקומים? {#measuring-similarity}
עקומים פוליגונליים משמשים לייצוג של נתונים ומידע במגוון רחב של יישומים. כאשר מדובר בכמויות עצומות של מידע, עולה הצורך בשיטות מדעיות לניתוח והפקת תובנות מנתונים – תחום זה נקרא מדעי הנתונים. במקרים רבים השיטות לניתוח נתונים מבוססות על מדד כלשהו להשוואה בין שני אובייקטים (פיסות מידע), אך לא תמיד ברור כיצד ניתן להגדיר מדד כזה, שישקף את התפיסה האינטואיטיבית שלנו לגבי השאלה מתי (או עד כמה) שני אובייקטים הם דומה זה לזה. בסרטון הבא נדון בשאלה הזו בהקשר של עקומים פוליגונליים: כיצד ניתן לקבוע עד כמה שני עקומים נתונים הם דומים זה לזה?

<center>![](images/12/similarity.jpg){width="80%"}</center>

#### צפו בסרטון הבא: {.unnumbered}



#### תרגיל: מרחק האוסדורף (Hausdorff) {.unnumbered}
<img src="images/12/hausdorff.jpg" width="30%" align="left"/>
בסרטון הגדרנו את מרחק האוסדורף, והסקנו שהוא מתאים יותר למדידת מרחק בין שתי קבוצות של נקודות. באופן פורמלי, מרחק האוסדורף בין שתי קבוצות של נקודות מוגדר כך:
בהינתן קבוצה \(P\) של \(n\) נקודות וקבוצה \(Q\) של \(m\) נקודות, **מרחק האוסדורף המכוון** הוא
\[\overrightarrow{d_H}(P,Q)=\max_{p\in P}\min_{q\in Q}\|p-q\|\]
ו**מרחק האוסדורף** הוא
\[d_H(P,Q)=\max(\overrightarrow{d_H}(P,Q),\overrightarrow{d_H}(Q,P))\]
הציעו אלגוריתם יעיל ככל האפשר לחישוב מרחק האוסדורף עבור שתי קבוצות של נקודות במישור.

#### קראו בספר הלימוד מההקדמה לפרק 30 ועד סעיף 30.1.1 (כולל).{.unnumbered}

## חלק 2: מרחק פְרֶשֶׁה (Fréchet) {#frechet-definition}

### מרחק פְרֶשֶׁה הדיסקרטי (Discrete Fréchet distance)  {#discrete-frechet}
לפני שנגדיר באופן פורמלי את מרחק פרשה, נדון בגרסה פשוטה יותר שלו: הגרסה הדיסקרטית. בסרטון הבא נגדיר את מרחק פרשה הדיסקרטי ונראה איך ניתן לחשב אותו.

#### צפו בסרטון הבא: {.unnumbered}
הגדרה, אלגוריתם תכנון דינאמי, המרחק החלש (על האלגוריתם יקראו בספר)


#### הגדרה: מרחק פְרֶשֶׁה הדיסקרטי {.unnumbered}
יהיו \(P=(p_,\dots,p_n)\) ו-\(Q=(q_1,\dots,q_m)\) שני עקומים בעלי \(n\) ו-\(m\) נקודות בהתאמה. 

<img src="images/12/discrete_frechet_def.jpg" width="40%" align="left"/>
**טיול (walk)** על \(P\) ו-\(Q\) הוא סדרה של זוגות 
\(\pi=((i_1,j_1),(i_2,j_2),\dots,(i_k,j_k))\)
כך שמתקיים:

- \((i_1,j_1)=(1,1)\),
- \((i_k,j_k)=(m,n)\),
- וגם לכל \(1\le t< k\) הזוג \((i_{t+1},j_{t+1})\) הוא אחת משלושת האפשרויות הבאות: \((i_t+1,j_t)\), \((i_t,j_t+1)\), או \((i_t+1,j_t+1)\).

במילים אחרות, טיול הוא מסלול מונוטוני על הגריד \([n]\times[m]\) מ-\((1,1)\) ל-\((n,m)\).

**מרחק פרשה הדיסקרטי** בין \(P\) ו-\(Q\) הוא 
\[d_{dF}(P,Q)=\min_{\pi \in \Pi}\max_{1\le t\le|\pi|}\|p_{i_t}-q_{i_t}\|\]
כאשר \(\Pi\) היא קבוצת כל הטיולים האפשריים על \(P\) ו-\(Q\).


::: rmdimportant
[**משפט**:]{.underline} ניתן לחשב את \(d_{dF}(P,Q)\) בזמן \(O(mn)\).
:::

<center>![](images/12/two-frogs.gif){width="80%"}</center>

#### הגדרה: מרחק פְרֶשֶׁה הדיסקרטי החלש {.unnumbered}
יהיו \(P=(p_,\dots,p_n)\) ו-\(Q=(q_1,\dots,q_m)\) שני עקומים בעלי \(n\) ו-\(m\) נקודות בהתאמה. 

**מרחק פרשה הדיסקרטי החלש** בין \(P\) ו-\(Q\) הוא 
\[d^w_{dF}(P,Q)=\min_{\pi \in \Pi^w}\max_{1\le t\le|\pi|}\|p_{i_t}-q_{i_t}\|\]
כאשר \(\Pi^w\) היא קבוצת כל המסלולים על הגריד \([n]\times[m]\) מ-\((1,1)\) ל-\((n,m)\) (לא בהכרח מונוטוניים).

::: rmdimportant
[**משפט**:]{.underline} ניתן לחשב את \(d^w_{dF}(P,Q)\) בזמן \(O(mn)\).
:::

#### ענו על השאלה הבאה:{.unnumbered}
התבוננו בשני העקומים הבאים, וההתאמה ביניהם. מי מהאיורים מתאר את מרחק פרשה הדיסקרטי החזק? ומי את החלש?

א. ![](images/12/discrete_frechet_q_a.jpg){width="70%"}

ב. ![](images/12/discrete_frechet_q_b.jpg){width="70%"}

מהו מרחק פרשה הדיסקרטי בין שני העקומים עבור המרחקים המצוינים באיור למטה? ומהו מרחק פרשה הדיסקרטי החלש ביניהם?
<center>![](images/12/discrete_frechet_q_c.jpg){width="70%"}</center>

<details>
<summary>(פתרון)</summary>
איור א מתאר את מרחק פרשה הדיסקרטי החזק, ו-ב' מתאר את המרחק החלש.
המרחק החזק הוא \(\sqrt{2}\) והחלש הוא 1.
</details>

#### ענו על השאלה הבאה: {.unnumbered}
אילו מההיגדים הבאים נכונים לכל שני עקומים \(P\) ו-\(Q\)?

1. \(d_H(P,Q)\le d_{dF}(P,Q)\)
2. \(d_{df}^w(P,Q)\le d_{dF}(P,Q)\)
3. \(d_H(P,Q)\le d_{dF}^w(P,Q)\)

<details>

<summary>(פתרון)</summary>
כולם נכונים.
<!--
TODO להוסיף היגדים לא נכונים, או לשנות את פורמט השאלה כך שיצטרכו לבחור את האופרטור המתאים
-->
</details>


#### קראו את סעיף 30.1.2 בספר הלימוד. {.unnumbered}
שימו לב שהגדרת המרחק בספר שונה במעט, ואינה מאפשרת צעד "באלכסון" על הגריד (קפיצה סימולטנית), אך הדבר אינו עקרוני עבור הנלמד ביחידה זו.


#### תרגיל: מרחק פְרֶשֶׁה הדיסקרטי עם קיצורי דרך {.unnumbered}
גרסה מעניינת נוספת של מרחק פרשה הדיסקרטי נקראת "מרחק פרשה הדיסקרטי עם קיצורי דרך". אם נחזור לאנלוגייה של זוג הצפרדעים, אז בגרסה זו מותר לצפרדע הכחולה לקפץ מעל נקודות בעקום שלה. הצפרדעים עדיין מתחילות את הטיול כאשר כל אחד מהן נמצאת על הנקודה הראשונה במסלול שלה, והן חייבות לסיים אותו כאשר כל אחת מהן נמצאת על הנקודה האחרונה במסלול שלה, אבל הצפרדע האדומה צריכה לקפץ דרך כל הנקודות שלה, ולצפרדע הכחולה מותר לדלג על נקודות (כמה שהיא רוצה, וכמה פעמים שהיא רוצה) באמצע המסלול. 

<center>![](images/12/shortcuts.jpg){width="80%"}</center>

1. הגדירו את "מרחק פרשה הדיסקרטי עם קיצורי דרך" באופן פורמלי (הגדירו walk בדומה להגדרה 30.1.1 בספר, ואז את המרחק בדומה להגדרה 30.1.2). שימו לב שהמרחק הזה אינו סימטרי.
2. הציעו אלגוריתם שמקבל שני מסלולים, \(P\) באורך \(n\) ו-\(Q\) באורך \(m\), ופרמטר \(\delta\), ובודק האם מרחק פרשה הדיסקרטי עם קיצורי דרך מ-\(P\) ל-\(Q\) הוא לכל היותר \(\delta\). רמז: הסתכלו על גריד הקונפיגורציות וחישבו על אלגוריתם חמדן.
3. נסו לחשוב: באילו מקרים מציאותיים גרסה זו של המרחק יכולה להחזיר תוצאות המשקפות טוב יותר את המציאות (לעומת מרחק פרשה הדיסקרטי ללא קיצורי דרך)?


### מרחק פְרֶשֶׁה הרציף {#continuous-frechet}
עד עכשיו ראינו תיאור רעיוני של מרחק פרשה, ולא הגדרנו ביטוי מתמטי שמתאר את המרחק בין שני עקומים. כיצד מגדירים את מרחק פְרֶשֶׁה הרציף באופן פורמלי?

<center>![](images/12/man-dog2.gif){width="80%"}</center>

בסעיף 30.1.3 מופיעה הגדרה מתמטית מדויקת של המרחק, שמתאימה גם לעקומים שאינם פוליגונלים. הרעיון הוא להגדיר עקום \(P\) בתור פונקציה מהתחום \([0,1]\) ל-\(\mathbb{R}^d\), ואת **"קצב ההליכה"** של האדם והכלב על העקום בתור פונקציה מ-\([0,1]\) ל-\([0,1]\). כלומר אם למשל העקום שלנו הוא
\(\pi:[0,1]\rightarrow\mathbb{R}^d\)
ופונקציית קצב ההליכה היא
\(f:[0,1]\rightarrow[0,1]\),
אז בזמן נתון \(t\in[0,1]\) האדם נמצא בנקודה
\(\pi(f(t))\).

#### נסו בעצמכם! {.unnumbered}
הזיזו את הסליידר של המשתנה \(t\) על מנת לראות כיצד נראית ההליכה על העקום \(P\) (הצבוע בשחור) תחת כל אחת מפונקציות הקצב השונות: האדומה, הכחולה והירוקה.

<center>
<iframe src="https://www.geogebra.org/classic/hzetb8mv?embed" width="100%" height="700" allowfullscreen style="border: 1px solid #e4e4e4;border-radius: 4px;" frameborder="0"></iframe>
</center>

#### ענו על השאלה הבאה: {.unnumbered}
איזו פונקציה מהסימולציה לעיל מתאימה לאיזו נקודה?
<details>

<summary>(פתרון)</summary>
האדומה היא \(h\), הכחולה היא \(f\) והירוקה היא \(g\).
</details>


#### קראו את סעיף 30.1.3 בספר הלימוד. {.unnumbered}
שימו לב לטעות בטקסט: בהגדרה 30.1.6 צריך להחליף את המילה width ב-\(\omega\).

## חלק 3: חישוב מרחק פְרֶשֶׁה הרציף {#computing-frechet}


### דיאגרמת המרחב החופשי (free space diagram) {#free-space-diagram}
כאשר רצינו לחשב את מרחק פרשה הדיסקרטי, נעזרנו במרחב הקונפיגורציות, וראינו שניתן לתאר אותו בתור גרף גריד או מטריצה דו מימדית. בסרטון הבא נראה כיצד ניתן לתאר את מרחב הקונפיגורציות עבור מרחק פרשה הרציף.

<center>![](images/12/free-space.jpg){width="100%"}</center>

#### צפו בסרטון הבא: {.unnumbered}
שני קטעים
בעיית ההחלטה

כדי להבין איך מתנהג מרחק פרשה הרציף, נתחיל במקרה הפשוט ביותר: כל אחד מהעקומים \(P\) ו-\(Q\) הוא קטע ישר. כלומר נניח ש-\(P\) הוא הקטע \(\overline{pp'}\) ו-\(Q\) הוא הקטע (\overline{qq'}\) כאשר 
\(p,p',q,q'\in\mathbb{R}^d\).


#### נסו בעצמכם! הדיאגרמה של שני קטעים {.unnumbered}

היישומון הבא מציג את הדיאגרמה של שני קטעים, \(P\) ו-\(Q\). תוכלו להזיז את הנקודה \(s\) כדי לראות את המיקומים המתאימים על גבי הקטעים. תוכלו גם לשנות את הרדיוס של המעגלים. מהן שתי הנקודות שמגדירות את מרחק פרשה בין שני הקטעים?

<center>
<iframe src="https://www.geogebra.org/classic/p5ub2xym?embed" width="100%" height="400" allowfullscreen style="border: 1px solid #e4e4e4;border-radius: 4px;" frameborder="0"></iframe>
</center>

ביישומון [הזה](https://www1.pub.informatik.uni-wuerzburg.de/pub/dijk/frechet/) מאת [Thomas van Dijk](https://github.com/tcvdijk) תוכלו לראות את הדיאגרמה של שני עקומים עם יותר מקטע אחד. כאשר תזיזו את העכבר על גבי הדיאגרמה, יסומנו הנקודות על העקומים שמתאימות לקונפיגורציה.


#### קראו את סעיף 30.2.2 בספר הלימוד. {.unnumbered}
שימו לב! למעוניינים בהרחבה והעשרה, ניתן לקרוא קודם  את סעיף 30.2.1 בספר הלימוד, המתאר את מרחק פרשה בין שני קטעים ומכיל את ההוכחות לכמה מהמשפטים שהוזכרו בסרטון.


#### ענו על השאלה הבאה: {.unnumbered}
באיור מטה מופיעה דיאגרמת המרחב החופשי של שני עקומים. התאימו לכל נקודה המסומנת על הדיאגרמה את זוג הנקודות המתאימות על גבי העקומים.

<center>![](images/12/q_diagram.jpg){width="100%"}</center>

<details>

<summary>(פתרון)</summary>
TODO
</details>

### אלגוריתם לבעיית ההחלטה {#frechet-decision}
<img src="images/12/path-in-free-space.jpg" width="50%" align="left"/>
האלגוריתם עבור בעיית ההחלטה מבצע סריקת BSF על דיאגרמת המרחב החופשי של שני העקומים עם פרמטר \(\delta\), וכך בעצם מחשב את **המרחב הנגיש** (reachable space) של הדיאגרמה. המרחב הנגיש הוא אוסף כל הנקודות בדיאגמת המרחב החופשי שניתן להגיע אליהן מהנקודה \((0,0)\) על ידי מסלול בדיאגרמה שהוא \((x,y)\) מונוטוני.

במהלך הסריקה, האלגוריתם מחשב את האינטרוולים הנגישים של כל תא שהוא פוגש, וממשיך בסריקה כל עוד יש לתא אינטרוול נגיש שאינו ריק. אם הוא מגיע לתא שמתאים לשני הקטעים האחרונים של העקומים, והנקודה \((m,n)\) היא נגישה, זה אומר שקיים מסלול בדיאגרמת המרחב החופשי מהנקודה \((0,0)\) לנקודה \((m,n)\), ולכן המרחק בין העקומים קטן מ-\(\delta\).

#### קראו את סעיף 30.2.3 בספר הלימוד. {.unnumbered}


#### ענו על השאלה הבאה: {.unnumbered}
התבוננו שוב באיור מהשאלה בסעיף הקודם. אילו מהנקודות המסומנות על גבי הדיאגרמה שייוכת למרחב הנגיש?

<center>![](images/12/q_diagram.jpg){width="100%"}</center>

<details>

<summary>(פתרון)</summary>
הנקודות \(a,b\) בלבד.
</details>

### הערכים הקריטיים {#frechet-critical-events}
בסעיף הקודם ראינו אלגוריתם לבעיית ההחלטה: בהינתן שני עקומים \(P\) ו-\(Q\) באורך \(n\) כל אחד, ופרמטר \(\delta\), אנחנו יודעים להחליט בזמן \(O(n^2)\) האם \(d_F(P,Q)\le \delta\). אבל כיצד נוכל למצוא את ה-\(\delta\) הקטן ביותר?

בדרך כלל, ניתן למצוא אוסף סופי (וקטן יחסית) של ערכים שאחד מהם הוא ערך הפתרון האופטימלי, ואז ניתן לבצע עליהם חיפוש בינארי כאשר משתמשים בפרוצדורת ההחלטה כדי להחליט האם להגדיל או להקטין את ערך החיפוש. האם זהו המצב במקרה של מרחק פרשה הרציף? האם מספיק לבדוק למשל רק את המרחקים בין כל זוג קודקודים? התבוננו למשל בשני העקומים הבאים. מה מגדיר את מרחק פרשה ביניהם?

<center>![](images/12/critical_value.jpg){width="70%"}</center>


בעצם הערכים שבהם אנחנו מעוניינים הם הערכים עבורם יש שינוי במספר רכיבי הקשירות של דיאגרמת המרחב החופשי. בפרט, ערך \(\delta\) הוא ערך קריטי אם קיימת נקודה כלשהי שהיא נגישה במרחב החופשי של \(\delta\), ולא נגישה במרחב החופשי של כל \(\delta'<\delta\). אפשר לחשוב על זה גם בצורה הבאה: נסתכל על "דיאגרמת פני השטח" שמוגדרת על שני העקומים. דמיינו שהיא מתמלאת במים לאט לאט. ככל שהמים עולים, כך מעברים מסויימים נסגרים. הערכים שעבורם קיים מעבר שנסגר הם הערכים הקריטיים.

בסעיף 30.2.4 בספר הלימוד מתוארים סוגי הערכים הקריטיים שרלוונטיים לחישוב מרחק פרשה.

#### קראו את סעיף 30.2.4 בספר הלימוד. {.unnumbered}
התעלמו מאבחנה 30.2.9.

#### שני סוגים של ערכים קריטיים {.unnumbered}
הערכים הקריטיים הרלוונטים לחישוב מרחק פרשה נקבעים על ידי:

1. צלע של עקום אחד וקודקוד של השני (vertex-edge event).
2. שני קודקודים של עקום אחד וצלע של העקום השני (monotonicity event).

#### ענו על השאלה הבאה: {.unnumbered}
איזה מהאיורים הבאים מתאר motonicity event?
<center>![](images/12/monotonicity_event_q.jpg){width="100%"}</center>


#### ענו על השאלה הבאה: {.unnumbered}
כמה ערכים קריטיים יש עבור שני עקומים \(P\) ו-\(Q\) באורך \(n\) כל אחד? ובכמה זמן ניתן למצוא אותם?

<details>

<summary>(פתרון)</summary>
יש \(O(n^3)\) ערכים כאלה, וניתן למצוא אותם בזמן \(O(n^3)\). 
</details>

### חישוב מרחק פרשה {#frechet-optimal}
כפי שראיתם בסעיף הקודם, יש \(O(n^3)\) ערכים קריטיים, וניתן למצוא אותם בזמן \(O(n^3)\). אם נעשה זאת ואז נבצע חיפוש בינארי בעזרת פרוצדורת ההחלטה, זמן הריצה של האלגוריתם יהיה \(O(n^3)\) (הזמן למציאת הערכים הקריטיים). בעזרת טכניקה מתקדמת יותר ([חיפוש פרמטרי](https://en.wikipedia.org/wiki/Parametric_search), שלא נראה בקורס הזה) ניתן לעשות זאת בזמן \(O(n^2\log n)\).

::: rmdimportant
[**משפט**:]{.underline} בהינתן שני עקומים בעלי n קודקודים בסך הכל, ניתן לחשב את מרחק פרשה ביניהם בזמן \(O(n^2\log n)\).
:::



טכניקת החיפוש הפרמטרי אמנם מספקת אלגוריתם עם זמן ריצה \(O(n^2\log n)\), אך היא נחשב קשה למימוש ולא מעשית. בסעיף 30.2.5 בספר הלימוד מתואר אלגוריתם רנדומי פשוט יותר לחישוב מרחק פרשה, אך הוא אינו נכלל בחומר של הקורס הזה.

#### להרחבה והעשרה: קראו את סעיף 30.2.5 בספר הלימוד. {.unnumbered}


#### תרגיל: מרחק פרשה תחת הזזה  {.unnumbered}
יתכן ששמת לב שמרחק פרשה אינו מושלם ויש לו מספר בעיות. אחת מהן היא שניתן להתשמש בו רק עבור עקומים שהם מיושרים זה כלפי זה....

הוכיחו שניתן לחשב קירוב 2 למרחק פרשה תחת הזזה בזמן...
(רמז: הראה שאם מזיזים עקום אחד כך שנקודות ההתחלה מתלכדות אז המרחק בין העקומים...)


#### מעניין לדעת: מרחק פרשה הוא פסאודו מטריקה

#### תרגיל: אי-שיוויון המשולש
