# מערכים ודואליות {#duality-arrangements}

## הקדמה {#preface-8}

### מה ביחידה? {#contents-8}

#### מערכים ודואליות {.unnumbered}

יחידה זו מקבילה לפרק השמיני בספר הלימוד. 

בסיום יחידה זו, תכירו את המושגים ותרכשו את הטכניקות והכלים הבאים:

- ה-discrepancy של קבוצת נקודות.
- רעיון הדואליות של נקודה וישר.
- מערך של ישרים במישור.
- הרמה (level) של נקודה במערך של ישרים.

למידה מהנה!

### דגימה גיאומטרית טובה {#geometric-sampling}

ההתמודדות עם נתוני עתק (big data) מציבה אתגר עצום בתחום טכנולוגית המידע, ואחת הדרכים להתמודד עם היקף מאסיבי של נתונים היא על ידי דגימה (sampling). למשל, בהינתן אוסף גדול מאוד של נקודות, ניתן לדגום מתוכן אוסף קטן יותר שישמש ייצוג קומפקטי של האוסף המקורי, ועליו ניתן לבצע חישובים ביעילות. גם כאשר רוצים למדל אובייקט רציף במחשב, משתמשים בדרך כלל באוסף סופי של נקודות או פיקסלים; למשל, כדי לייצג את פני השטח במפה טופוגרפית, לוקחים מדידות של גובה בנקודות אקראיות (האיור למטה לקוח [מהמאמר הזה](https://www.researchgate.net/figure/Figure-Topographic-map-of-High-Mountain-Asia-HMA-based-on-SRTM-VV-data-with_fig7_323301551), ומציג מפה טופוגרפית של אזור הררי באסיה, עם 2,500 נקודות שנבחרו בדגימה מקרית).

<center>

![](images/8/Topographic-map.png){width="70%"}

</center >

הבחירה בדגימה מקרית של נקודות לעומת דגימה תבניתית יכולה לנבוע מכמה סיבות:

-   דגימה מקרית מאפשרת הוכחה של חסמים הסתברותיים (חסמים על התוחלת).
-   לפעמים דגימה מקרית נראית טבעית יותר לעין האנושית. <!-- -   האובייקט שאותו ממדלים עלול "להתאים" לתבנית באופן כזה שאוסף הנקודות לא ישקף את המציאות. -->

<img src="08-duality-arrangements_files/figure-html/unnamed-chunk-1-1.png" width="60%" style="display: block; margin: auto;" />

עם זאת, לא כל דגימה מקרית תהיה "טובה", כלומר היינו רוצים שפיזור הנקודות שנדגמו יהיה פחות או יותר אחיד, כדי שישקף את המצב המקורי. נסביר זאת בסעיף הבא בעזרת מושג שנקרא discrepancy.

### ה-discrepancy של קבוצת נקודות {#discrepancy-definition}

<img src="images/8/discrepancy.jpg" align="left" width="33%"/> נניח שדגמנו קבוצה $S$ של $n$ נקודות מריבוע היחידה $U=[0,1]\times [0,1]$. היינו רוצים שלקבוצה $S$ תהיה התכונה הבאה: לכל חצי מישור $h$, **שיעור** הנקודות מ-$S$ שנמצאות ב-$h$ יהיה פחות או יותר כמו גודל החיתוך של $h$ עם $U$.

באופן פורמלי יותר, נגדיר את **המדד הרציף** של $h$ להיות השטח של $h \cap U$. נסמן אותו ב-$\mu(h)$. נוסף על כך, נגדיר את **המדד הדיסקרטי** של $h$ להיות $\mu_S(h)=|S\cap h|/|S|$. הדגימה $S$ תהיה טובה אם לכל בחירה של חצי מישור $h$ יתקיים $\mu(h)\approx\mu_S(h)$.\
במתמטיקה, מושג זה נקרא [Discrepancy](https://en.m.wikipedia.org/wiki/Discrepancy_theory). מדד ה-discrepancy של חצי המישור $h$ מוגדר להיות: $$\Delta_S(h)=|\mu(h)-\mu_S(h)|.$$

#### דוגמה: {.unnumbered}
<img src="images/8/example.jpg" align="left" width="30%"/> 
באיור משמאל, הקבוצה $S$ מכילה חמש נקודות. חצי המישור $h$ מכיל רק שתי נקודות מתוך $S$, ולכן המדד הדיסקרטי של $h$ הוא $\mu_S(h)=|S\cap h|/|S|=2/5$. שטח החיתוך של חצי המישור $h$ עם ריבוע היחידה $U$ הוא בדיוק $1/2$, ולכן מדד ה-discrepancy של $h$ הוא $$\Delta_S(h)=|\mu(h)-\mu_S(h)|=|1/2-2/5|=1/10.$$


#### הגדרה: מדד ה-discrepancy של קבוצת נקודות {.unnumbered}
::: rmdimportant
נסמן ב-$\mathcal{H}$ את אוסף כל חצאי המישורים. מדד ה-discrepancy של הקבוצה $S$ ביחס לחצאי מישור מוגדר להיות: $$\Delta_S(\mathcal{H})=\sup_{h\in\mathcal{H}}\Delta_S(h).$$ 
:::

במילים אחרות, זהו חצי המישור ה"**גרוע ביותר**", כלומר זה שעבורו מדד ה-discrepancy הוא **מקסימלי**. אינטואיטיבית, ככל שמדד ה-discrepancy מתקרב ל-0, כך הדגימה $S$ טובה יותר, כלומר מפוזרת באופן אחיד יותר על פני $U$.

(הערה: בסעיף 8.1 בספר הלימוד, הסימון למדד ה-discrepancy של קבוצה $S$ ביחס לחצאי מישור הוא $\Delta_\mathcal{H}(S)$, אך זוהי ככל הנראה שגיאת דפוס.)

#### ענו על השאלה הבאה: {.unnumbered}
התבוננו באיור הבא שבו מופיעה קבוצה $S$ של נקודות (כחולות) בתוך ריבוע היחידה $U$, וחצי מישור $h$.

<center>![](images/8/discrepancy-exercise.jpg){width="30%"}</center>

1.  מהו המדד הדיסקרטי של $h$?
2.  מהו המדד הרציף של $h$?
3.  מהו $\Delta_S(h)$?
4.  האם יש חצי מישור שהוא "גרוע יותר" מ-$h$? כלומר מדד ה-discrepancy שלו גדול יותר?

<details>

<summary>(פתרון)</summary>

1. הקבוצה $S$ מכילה 12 נקודות. חצי המישור $h$ מכיל שמונה מהן, ולכן המדד הדיסקרטי הוא $8/12=2/3$.

2. שטח החיתוך של $h$ עם $U$ הוא $1/2+1/8=5/8$ (ניתן לראות שהוא מכיל את שתי השורות התחתונות של הגריד, כלומר החצי התחתון של ריבוע היחידה, ועוד חצי מהשורה השלישית מלמטה).

3. באופן כללי, ניתן לחשב את השטח על ידי מציאת נקודות החיתוך של הישר המגדיר את חצי המישור $h$ עם ריבוע היחידה, ואז לחשב את השטח כסכום של שטח מלבן ושטח משולש. קיבלנו $\Delta_S(h)=2/3-5/8=1/24$.

4. שימו לב שקיימים מספר חצאי מישורים שלא מכילים אף נקודה כחולה, ושטח החיתוך שלהם עם הריבוע גדול מ-$1/24$. לכן חצאי מישורים אלו "גרועים יותר" מ-$h$.

</details>


### חישוב ה-discrepancy של קבוצת נקודות {#discrepancy}

עכשיו נוכל לשאול: כיצד ניתן לחשב את $\Delta_S(\mathcal{H})$?

בעצם אנחנו מחפשים חצי מישור $\hat{h}$ שעבורו $\Delta_S(\mathcal{H})=\Delta_S(\hat{h})$ , כלומר לכל $h\in\mathcal{H}$ מתקיים $\Delta_S(\hat{h})\ge \Delta_S(h)$.

<img src="images/8/discrepancy-obs.jpg" align="left" width="30%"/> אבחנה מיידית ראשונה היא שהישר שמגדיר את $\hat{h}$ חייב לעבור דרך לפחות נקודה אחת מ-$S$: אם זה לא המצב, נוכל להזיז מעט את הישר המגדיר את $\hat{h}$ לעבר הנקודה הקרובה ביותר אליו מאחד הצדדים, מבלי לשנות את המידה הדיסקרטית שלו. המידה הרציפה תגדל או תקטן, ובאחד הצדדים נקבל מדד discrepancy גדול יותר.

#### המועמדים להיות $\hat{h}$ {.unnumbered}

כדי לחשב את $\Delta_S(\mathcal{H})$, היינו רוצים למצוא מספר סופי של מועמדים להיות $\hat{h}$. בסעיף 8.1 בספר הלימוד מוכיחים את הטענה הבאה:

::: rmdimportant
*טענה (8.1 בספר הלימוד)**:

חצי מישור $h$ שעבורו $\Delta_S(h)$ מקסימלי, הוא אחד משני הסוגים הבאים:

1.  ל-$h$ יש בדיוק נקודה אחת מ-$S$ על שפתו,
2.  ל-$h$ יש לפחות 2 נקודות על שפתו.

נוסף על כך, מספר המועמדים מהסוג הראשון הוא $O(n)$, וניתן למצוא אותם בזמן $O(n)$.
:::

בהינתן מועמד $h$, נוכל לחשב את המידה הרציפה שלו בזמן קבוע, ואת המידה הדיסקרטית שלו בזמן $O(n)$. מכיוון שמספר המועמדים מהסוג הראשון הוא $O(n)$ וגם ניתן למצוא אותם בזמן $O(n)$, סך כל הזמן שייקח לנו לחשב את $\Delta_S(h)$ עבור כל המועמדים מסוג זה הוא $O(n^2)$.

מה בנוגע למועמדים מהסוג השני? מכיוון שיש $O(n^2)$ כאלה, נצטרך לבצע את חישוב המידה הדיסקרטית שלהם באופן אחר. בהמשך היחידה נלמד טכניקה חשובה ומרתקת שתאפשר לנו לעשות זאת בזמן $O(n^2)$ בסך הכול! לטכניקה הזו קוראים **דואליות של נקודה וישר**.

**הערה**: ביחידה זו נדלג על ההקדמה לפרק 8 בספר הלימוד, וכן על סעיף 8.1. כמו כן, לא נוכיח את הטענה שלעיל, ורק נראה כיצד ניתן להשתמש בה כדי לחשב את ה-discrepancy.

#### ענו על השאלה הבאה: {.unnumbered}
באיור למטה מופיעים ארבעה חצאי מישור, $h_1,h_2,h_3,h_4$, כולם עוברים דרך אותה נקודה מ-$S$. שימו לב ש-$h_i$ מתקבל מ-$h_{i-1}$ על ידי סיבוב של הישר המגדיר אותו נגד כיוון השעון. כל חצאי המישורים מכילים בדיוק את אותה קבוצת נקודות מ-$S$. למי מהם $\Delta_S$ מקסימלי? למי מינימלי?

<center>![](images/8/discrepancy-exercise2.jpg){width="40%"}</center>

<details>

<summary>(פתרון)</summary>

שטח החיתוך של $h_1$ או $h_2$ עם $U$ הוא הגדול ביותר, והוא שווה ל-$3/4$. השטח קטן יותר ויותר לאחר שעוברים את $h_2$ ומסובבים לכיוון $h_4$. שטח החיתוך של $h_4$ עם $U$ הוא הקטן ביותר. כולם מכילים $4/5$ מהנקודות ב-$S$, ולכן ככל ששטח החיתוך קטן נקבל הפרש גדול יותר בין המדד הדיסקרטי לרציף. לכן המדד המקסימלי יתקבל עבור $h_1$ ו-$h_2$, והמינימלי עבור $h_4$.

</details>


## דואליות של נקודה וישר {#point-line-duality}

### הגדרת הטרנספורמציה הדואלית {#definition}

ביחידה 3 דיברנו על [הגרף הדואלי לשילוש](#dual-graph), וראינו שבעזרתו ניתן לחשב בקלות צביעה חוקית של קודקודי המשולשים בשלושה צבעים (שימו לב שניתן להגדיר באופן דומה גרף דואלי לגרף מישורי שפאותיו הן לא בהכרח משולשים). באופן כללי, **דואליות** היא כלי חשוב בניתוח ופתרון של בעיות גיאומטריות: היא מאפשרת לנו להסתכל על בעיה נתונה מפרספקטיבה שונה, על ידי תיאור של בעיה דואלית שקולה. לפעמים הבעיה הדואלית נראית פשוטה הרבה יותר לפתרון, ואז ניתן להפוך את הפתרון לבעיה הדואלית לפתרון לבעיה המקורית.

ביחידה זו נדבר על הדואליות של נקודות וישרים במישור. נקודה $p$ במישור מתוארת על ידי שתי הקואורדינטות שלה, למשל, $p=(p_x,p_y)$. גם ישר (לא אנכי) $y=mx+b$ מתואר על ידי שני פרמטרים: השיפוע שלו, $m$, והגורם הקבוע, $b$. לכן ניתן למפות נקודה לישר, ולהפך, באופן חד-חד-ערכי. ניתן לחשוב על טרנספורמציות שונות, אך בקורס הזה נעסוק בטרנספורמציה הפשוטה הבאה.

#### הגדרה: הטרנספורמציה הדואלית {.unnumbered}

::: rmdimportant

-   הישר הדואלי לנקודה $p=(p_x,p_y)$ יסומן ב-$p^*$. והוא: $p^*:~ y=p_x x-p_y$
-   הנקודה הדואלית לישר $\ell:~ y=mx+b$ תסומן $\ell^*$. והיא: $\ell^*=(m,-b)$

:::

#### דוגמה: {.unnumbered}

-   הישר הדואלי לנקודה $p=(3,1)$ הוא $p^*:~ y=3x-1$.
-   הנקודה הדואלית לישר $\ell:~ y=x+2$ היא $\ell^*=(1,-2)$.

<center>![](images/8/duality-example.jpg){width="50%"}</center>


#### תכונות הטרנספורמציה – נסו בעצמכם! {.unnumbered}

הטרנספורמציה הדואלית שהגדרנו ממפה אובייקטים מ**המישור הראשי** (primal plane) ל**מישור הדואלי** (dual plane), ויש לה מספר תכונות מעניינות, שאותן נראה מייד. אך לפני כן, נסו לבחון בעצמכם את תכונות הטרנספורמציה הדואלית בעזרת היישומון הבא.

<center>

<iframe src="https://www.desmos.com/calculator/zhezzindqi?embed" width="100%" height="500" style="border: 1px solid #ccc" frameborder="0">

</iframe>

</center>


#### ענו על השאלה הבאה: {.unnumbered}
התבוננו באיור הבא, והתאימו בין נקודה לישר הדואלי שלה.

<center>![](images/8/point-line-ex.jpg){width="60%"}</center>

<details>

<summary>(פתרון)</summary>

זיכרו שקואורדינטת ה-$x$ ממופה לשיפוע הישר, וקואורדינטת ה-$y$ לחיתוך עם ציר ה-$y$.

הנקודה $p_1$ נמצאת על ציר ה-$y$, כלומר קואורדינטת ה-$x$ שלה היא אפס, ולכן לישר הדואלי המתאים לה יהיה שיפוע 0, כלומר זהו $\ell_3$.

הנקודה $p_2$ נמצאת על ציר ה-$x$, כלומר קואורדינטת ה-$y$ שלה היא אפס, ולכן הישר הדואלי המתאים לה ייחתך עם ציר ה-$y$ בראשית הצירים, ולכן זהו $\ell_1$.

עבור הנקודה $p_3$ נשאר לנו הישר $\ell_2$, אבל אפשר לזהות זאת גם ללא אלימינציה: לנקודה $p_3$ קואורדינטת $x$ חיובית וקואורדינטת $y$ שלילית, ואכן השיפוע של $\ell_2$ חיובי, והוא נחתך עם ציר ה-$y$ מעל הראשית.

</details>

### תכונות הטרנספורמציה הדואלית {#properties}

כדי שנוכל להשתמש בטרנספורמציה הדואלית שהגדרנו, ננסה להבין תחילה מה היחס בין המישור הדואלי למישור הראשי, כלומר אילו תכונות נשמרות וכיצד. בסרטון הבא נבחן יחד את הטרנספורמציה הדואלית ואת התכונות שלה.

#### צפו בסרטון הבא: {.unnumbered}

<center>

<iframe width="560" height="315" src="https://www.youtube.com/embed/7NoXMGXNZvY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen>

</iframe>

</center>

בסרטון ראינו את האבחנה הבאה לגבי תכונות הטרנספורמציה הדואלית.

::: rmdimportant
**אבחנה (8.3 בספר הלימוד)**:

תהי $p$ נקודה ו-$\ell$ ישר לא אנכי, שניהם במישור. הטרנספורמציה הדואלית $o\rightarrow o^*$ מקיימת את התכונות הבאות:

1.  **משמרת יחס חילה** (incidence preserving): $p\in \ell$ אם ורק אם $\ell^*\in p*$.
2.  **משמרת סדר** (order preserving): $p$ מעל $\ell$ אם ורק אם $\ell^*$ מעל $p^*$.

:::
<center>![](images/8/dual-primal.jpg){width="80%"}</center>

#### קטע במישור הדואלי – נסו בעצמכם! {.unnumbered}
ראינו שבמישור הדואלי, קטע $s=\overline{pq}$ הוא איחוד הישרים הדואליים לנקודות על $s$. כלומר $s^*$ הוא אוסף אינסופי של ישרים, שלכולם נקודת חיתוך אחת. ניתן לראות זאת ביישומון הבא: הזיזו את הנקודה השחורה שעל הקטע $\overline{pq}$, ותוכלו לראות כיצד הישר הדואלי (הצבוע בשחור) משתנה ביחס לישרים הדואלים ל-$p$ ו-$q$.

<center>
<iframe src="https://www.desmos.com/calculator/bhy5azkiwk?embed" width="80%" height="500" frameborder="0" style="font-size: 1rem; border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204);">
</iframe>
</center>

#### ענו על השאלה הבאה: {.unnumbered}
מהו האובייקט הדואלי ל-:

1. $k$ נקודות שכולן על ישר אחד (לא אנכי)?
2. $k$ ישרים מקבילים?
3. חצי המישור שמעל ישר (לא אנכי)?

<details>

<summary>(פתרון)</summary>

1. נניח שהנקודות $p_1,\dots,p_k$ נמצאות כולן על ישר $\ell$ במישור הראשי. מכאן שבמישור הדואלי, הנקודה $\ell^*$ נמצאת על הישרים $p_1,\dots,p_k$. כלומר הטרנספורמציה הדואלית של אוסף נקודות שנמצאות על ישר אחד היא אוסף של ישרים הנחתכים כולם באותה נקודה.
2. נניח שהישרים $\ell_1,\dots,\ell_k$ מקבילים. אז לכולם אותו שיפוע $a$. לכן במישור הדואלי כל נקודה דואלית $\ell^*_i$ היא מהצורה $(a,b_i)$, כלומר כל הנקודות הדואליות נמצאות על אותו ישר אנכי, $x=a$.
3. נסמן ב-$\ell$ את הישר המגדיר את חצי המישור $h$. במישור הראשי, כל נקודה $p$ ב-$h$ נמצאת מעל $\ell$, ולכן במישור הדואלי, הנקודה $\ell^*$ נמצאת מעל הישר $p^*$. כלומר הטרנספורמציה הדואלית של חצי מישור היא אוסף הישרים שעוברים מתחת לנקודה.

</details>


#### הגדרה שקולה {.unnumbered}
בסעיף 8.2 בספר הלימוד מתוארת דרך אחרת לחשוב על הטרנספורמציה הדואלית -- בעזרת הפרבולה $\mathcal{U}:~ y=x^2/2$. עבור נקודה $p$ שנמצאת על הפרבולה, הישר הדואלי $p^*$ הוא בדיוק הישר המשיק לפרבולה בנקודה $p$. עבור נקודה $q$ שלא נמצאת על הפרבולה, ושיש לה אותה קואורדינטת $x$ כמו ל-$p$, השיפוע של $q^*$ הוא בדיוק השיפוע של $p^*$, אך $q^*$ מוזז לפי ההפרש בקואורדינטת ה-$y$. כלומר $q^*$ הוא הישר המקביל ל-$p^*$ ועובר דרך נקודה $q'$, שהיא תמונת מראה של $q$ ביחס לישר האופקי העובר דרך $p$. תוכלו לראות את הקשר הזה בעזרת היישומון הבא.

<center>

<iframe src="https://www.desmos.com/calculator/ntcunrsyha?embed" width="100%" height="500" style="border: 1px solid #ccc" frameborder="0">

</iframe>

</center>


#### קראו את סעיף 8.2 בספר הלימוד (עמודים 177--179). {.unnumbered}
החלק האחרון של סעיף 8.2 מתאר כיצד ניתן להשתמש בדואליות כדי לחשב את ה-discrepancy של קבוצת נקודות. נחזור לכך בהמשך, לאחר שנדבר על מערכים של ישרים במישור, ולכן דלגו בשלב זה על שתי הפסקאות האחרונות של סעיף 8.2.


## מערכים של ישרים במישור {#line-arrangements}

### מערך של ישרים במישור: מבנה וגודל {#complexity}

<img src="images/8/line-arr.jpg" align="left" width="33%"/> קבוצה $L$ של $n$ ישרים במישור מחלקת את המישור לאוסף של תאים (פאות), צלעות וקודקודים. חלוקה כזאת של המישור נקראת **מערך של ישרים** (line arrangement), ומסומנת $\mathcal{A}(L)$. בסרטון הבא נדבר על המבנה ועל הגודל של מערכי ישרים במישור.

#### צפו בסרטון הבא: {.unnumbered}

<center>

<iframe width="560" height="315" src="https://www.youtube.com/embed/PRkNBpBVMqc" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen>

</iframe>

</center>

ראינו שלמערך $\mathcal{A}(L)$ של ישרים במישור יש שלושה סוגי רכיבים:

-   קודקודים -- כאשר כל קודקוד הוא נקודת חיתוך בין ישרים מ-$L$.
-   צלעות -- כאשר כל צלע היא קטע (פתוח) או קרן (שצידה האחד פתוח וצידה שני לא חסום) על אחד הישרים.
-   פאות -- כאשר כל פאה היא רכיב קשיר מקסימלי של נקודות שלא נמצאות על אחד הישרים.

הפאות הן כמובן קמורות, שכן הן נוצרות מחיתוך של חצאי מישורים.

כמו כן, הגדרנו שהמערך $\mathcal{A}(L)$ הוא **פשוט** אם אין ב-$L$ שלושה ישרים שעוברים דרך אותה נקודה, ואין ישרים מקבילים.

::: rmdimportant
**משפט (8.4 בספר הלימוד)**:

תהי $L$ קבוצה של $n$ ישרים במישור, ויהי $\mathcal{A}(L)$ המערך של $L$. מתקיים:

1.  מספר הקודקודים ב-$\mathcal{A}(L)$ הוא לכל היותר $n(n-1)/2$.
2.  מספר הצלעות ב-$\mathcal{A}(L)$ הוא לכל היותר $n^2$.
3.  מספר הפאות ב-$\mathcal{A}(L)$ הוא לכל היותר $n^2/2+n/2+1$.

כמו כן, מתקיים שוויון בכל השלושה אם ורק אם $\mathcal{A}(L)$ הוא מערך פשוט.
:::

#### קראו את חלקו הראשון של סעיף 8.3 בספר הלימוד (עמודים 179--180). {.unnumbered}

(קראו עד ההוכחה של משפט 8.4, כולל)

### ייצוג ובניית המערך {#construcion}

בעמוד הקודם ראינו שהמערך $\mathcal{A}(L)$ של אוסף $L$ של ישרים הוא חלוקה של המישור, ואסימפטוטית הוא לכל היותר מגודל ריבועי (במספר הישרים).

#### כיצד נייצג מערך של ישרים? {.unnumbered}

<img src="images/8/DCEL.jpg" align="left" width="40%"/> נוכל להשתמש במבנה DCEL שראינו ביחידה 2, שיאפשר לנו לעבור מפאה לפאה, לגשת לרשימת כל הצלעות שמגדירות פאה נתונה, ועוד. שימו לב שהמערך $\mathcal{A}(L)$ מכיל גם צלעות אינסופיות, ולכן כדי להשתמש במבנה DCEL נצטרך להשתמש בטריק שכבר ראינו בעבר: נמצא מלבן $R$ מספיק גדול שמכיל את כל הקודקודים של $\mathcal{A}(L)$ בפנימו.

#### בניית ה-DCEL {.unnumbered}

כדי לבנות את ה-DCEL עבור $\mathcal{A}(L)$ המוכל במלבן $R$, נוכל פשוט להשתמש באלגוריתם הסורק שראינו ביחידה 2. האלגוריתם ימצא את כל נקודות החיתוך בין קטעים, שהם הקודקודים של המערך, בזמן $O(n^2\log n)$, ובעזרתו נוכל (על ידי מספר שינויים פשוטים) גם לחשב את מבנה ה-DCEL.

#### תרגיל {.unnumbered}
חשבו מהם השינויים הנדרשים באלגוריתם הסורק כדי לחשב את מבנה ה-DCEL של מערך ישרים.


#### להרחבה ולהעשרה: אלגוריתם יעיל יותר {.unnumbered}

בחלקו השני של סעיף 8.3 בספר הלימוד (עמודים 181--185) מתואר אלגוריתם אינקרמנטלי לבניית מערך של ישרים. זמן הריצה שלו הוא $O(n^2)$ בלבד, אך הוא מסובך יותר ולא נלמד אותו בקורס זה.

### רמה (level) של נקודה במערך {#vertex-level}

לפני שנוכל לחזור לפתרון בעיית חישוב ה-discrepancy, נגדיר מונח נוסף שיעזור לנו במשימה הזאת (ובעוד רבות אחרות).

#### הגדרה: רמה של נקודה במערך של ישרים {.unnumbered}
::: rmdimportant

הרמה (level) של נקודה $r$ במערך של ישרים היא מספר הישרים שעוברים מעל $r$ (מעל ממש, כלומר לא עוברים דרך $r$).
:::

#### דוגמה: {.unnumbered}

הרמה של הנקודה $p$ היא 3, מכיוון שעוברים מעליה שלושה ישרים: $\ell_1,\ell_4,\ell_5$.

מהי הרמה של הנקודה $q$? שימו לב ש-$q$ היא קודקוד של מערך הישרים, ורק הישר $\ell_4$ עובר מעליה. לכן הרמה של $q$ היא 1.

<center>![](images/8/level-example.jpg){width="50%"}</center>


#### כיצד נוכל לחשב את הרמה של קודקוד במערך ישרים? {.unnumbered}

בהינתן מבנה DCEL של המערך $\mathcal{A}(L)$, נוכל לחשב את הרמות של כל הקודקודים במערך בזמן $O(n^2)$ בסך הכול, בעזרת האלגוריתם הבא.\

<center>![](images/8/levels-alg.jpg){width="75%"}</center>

עבור ישר $\ell\in L$ כלשהו, נמצא את הקודקוד השמאלי ביותר שנמצא עליו, $v_1$, ונחשב את הרמה שלו, $level(v_1)$, בזמן $O(n)$ על ידי בדיקת כל הישרים האחרים. לאחר מכן, נוכל להתקדם לאורך הישר $\ell$ בעזרת מבנה ה-DCEL מהקודקוד הנוכחי, $v_i$, אל הקודקוד שמימינו, $v_{i+1}$, ולחשב את הרמה של $v_{i+1}$ בהינתן $level(v_i)$ בזמן קבוע:

1.  נאתחל $level(v_{i+1})\leftarrow level(v_i)$.
2.  אם הישר דרך $v_i$ עובר מעל $v_{i+1}$, נוסיף 1 ל-$level(v_{i+1})$.
3.  אם הישר דרך $v_{i+1}$ עובר מעל $v_i$, נחסיר 1 מ-$level(v_{i+1})$.

(שימו לב ש-2 ו-3 יכולים להתקיים יחד, ואז הרמה של $v_{i+1}$ לא תשתנה).


#### ענו על השאלה הבאה: {.unnumbered}
מהי הרמה של כל אחד מהקודקודים על הישר $\ell$ במערך הישרים שבאיור?

<center>![](images/8/levels-q.jpg){width="85%"}</center>

<details>

<summary>(פתרון)</summary>

<center>![](images/8/levels-ans.jpg){width="85%"}</center>

</details>


#### מעניין לדעת: כמה קודקודים יש ברמה החציונית? {.unnumbered}
הרמה ה-$k$-ית של מערך $\mathcal{A}(L)$ של $n$ ישרים במישור היא אוסף הקודקודים של $\mathcal{A}(L)$ שהרמה שלהם היא $k$. כמה קודקודים יש ברמה ה-$n/2$? זוהי בעיה פתוחה. למעשה, ידוע חסם תחתון של $\Omega(n\log n)$ וחסם עליון של $O(n^{4/3})$.


### הכוח של דואליות

נחזור לבעית חישוב ה-discrepancy של קבוצת נקודות. בהינתן קבוצה $S$ של $n$ נקודות, המטרה שלנו בסוף החלק הראשון של יחידה זו הייתה לחשב לכל זוג נקודות $p,q\in S$ את המדד הדיסקרטי של חצי המישור שחסום על ידי הישר $\ell(p,q)$ העובר דרך $p$ ו-$q$. במישור הדואלי, הנקודה $\ell(p,q)^*$ (הדואלית לישר $\ell(p,q)$) היא נקודת החיתוך בין $p^*$ (הישר הדואלי ל-$p$), ל-$q^*$ (הישר הדואלי ל-$q$). לכן נקודה $s$ נמצאת מתחת לישר $\ell(p,q)$ במישור הראשי, אם ורק אם הישר $s^*$ עובר מתחת לנקודה $\ell(p,q)^*$ במישור הדואלי.

<center>![](images/8/dual-discrepancy.jpg){width="80%"}</center>

שימו לב שבמישור הדואלי, $S$ היא קבוצה $S^*$ של ישרים, שמהווה מערך של ישרים. מכאן, שמספר הנקודות מ-$S$ שנמצאות בחצי המישור הפתוח שמוגדר על ידי $\ell(p,q)$ ונמצא מתחתיו, שווה למספר הישרים במישור הדואלי שעוברים מעל הנקודה $\ell(p,q)^*$. זוהי בדיוק הרמה של הקודקוד $\ell(p,q)^*$ במערך הישרים $\mathcal{A}(S^*)$.

כמו שראינו בחלק הקודם, ניתן לחשב את הרמות של כל הקודקודים במערך ישרים בזמן $O(n^2)$, ולכן נוכל לחשב את ה-discrepancy של $S$ בזמן $O(n^2)$. 

#### קראו את סעיף 8.4 בספר הלימוד (עמודים 185--186).



## תרגילים נוספים {#exercises}

#### תרגיל {.unnumbered}
תארו אלגוריתם שבהינתן אוסף $L$ של $n$ ישרים במישור, מוצא בזמן $O(n\log n)$ מלבן $R$ שמכיל את כל הקודקודים של $\mathcal{A}(L)$ בפנימו.

#### תרגיל {.unnumbered}
נתון אוסף $C$ של $n$ מעגלים במישור. שימו לב שגם אוסף זה מהווה חלוקה של המישור לתאים. הצלעות במערך המעגלים יהיו קשתות של מעגלים מ-$C$. שימו לב שהפאות במערך המעגלים אינן בהכרח קמורות. מהי הסיבוכיות של מערך מעגלים?

#### תרגיל {.unnumbered}
כפי שראיתם, בבעיות רבות בגיאומטריה חישובית אנחנו מניחים (לשם פשטות) שהקלט אינו מכיל שלוש נקודות הנמצאות על ישר אחד. כיצד ניתן לוודא זאת? בדיקה זו נקראת בדיקת קו-ליניארית, ואלגוריתם נאיבי יבדוק כל שלוש נקודות, בזמן של $O(n^3)$. חשבו כיצד ניתן להשתמש ברעיון הדואליות כדי לבדוק זאת בזמן $O(n^2)$ בלבד.
