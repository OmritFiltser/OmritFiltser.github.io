<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Computational Geometry Conferences</title>
    <style>
    /* ... (same styles as before) ... */
    body { font-family: sans-serif; margin: 20px; }
    h1 { text-align: center; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    tr:nth-child(even) { background-color: #f9f9f9; }
    a { color: blue; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .loading { text-align: center; font-style: italic; }
    @media (max-width: 768px) {
        table { font-size: 14px; }
		/* Keep Event, Location and website, hide others */
        th, td { padding: 5px; }
		th:not(:nth-child(1)):not(:nth-child(2)):not(:nth-child(8)),
        td:not(:nth-child(1)):not(:nth-child(2)):not(:nth-child(8))  { display: none; }
        table { display: block; overflow-x: auto; white-space: nowrap; }
    }
    </style>
</head>
<body>
    <h1>Computational Geometry Conferences</h1>
    <p class="loading">Loading conference data...</p>
    <table id="conferenceTable">
        <thead><tr></tr></thead>
        <tbody></tbody>
    </table>

    <script>
    async function fetchAndDisplayConferences() {
        const sheetId = "11Jggxd8R_U6fuJaeA1CJVpLK5R63ikHYlbaT2eF9B0A";
        const gid = '0';
        const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&gid=${gid}`;

        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const text = await response.text();
            const json = parseGoogleSheetsJSONP(text);

            const tableData = json.table;
            const headers = tableData.cols.map(col => col.label);

             // Create a mapping of column IDs to their indices
            const colIdToIndex = {};
            tableData.cols.forEach((col, index) => {
                colIdToIndex[col.id] = index;
            });

            // Populate table headers (still the same)
           const headerRow = document.querySelector("#conferenceTable thead tr");
            headers.forEach(header => {
                const th = document.createElement("th");
                th.textContent = header;
                headerRow.appendChild(th);
            });

            // Populate table body, using column IDs
            const tableBody = document.querySelector("#conferenceTable tbody");
            tableData.rows.forEach(row => {
                const tr = document.createElement("tr");

                // Helper function to get cell data by column ID
                function getCell(colId) {
                    const colIndex = colIdToIndex[colId];
                    if (colIndex !== undefined && row.c[colIndex]) {
                        const cell = row.c[colIndex];
                        return cell.f ? cell.f : cell.v; // Prefer formatted (.f) value
                    }
                    return "";
                }

                // --- Create cells in the desired order ---
                // Event (with link from name)
                const eventTd = document.createElement("td");
                const eventName = getCell("A");
                const colIndexH = colIdToIndex["H"];

                if (colIndexH !== undefined && row.c[colIndexH] && row.c[colIndexH].v && row.c[colIndexH].v.startsWith("http")) {
                    const a = document.createElement("a");
                     a.href =  row.c[colIndexH].v; // Use the RAW value for the URL
                    a.textContent = eventName;
                    a.target = "_blank";
                    eventTd.appendChild(a);
                } else {
                    eventTd.textContent = eventName;
                }
                tr.appendChild(eventTd);

                // Other columns
                tr.appendChild(createTd(getCell("B")));  // Location
                tr.appendChild(createTd(getCell("C")));  // Deadline
                tr.appendChild(createTd(getCell("D")));  // Abstract
                tr.appendChild(createTd(getCell("E")));  // Notification
                tr.appendChild(createTd(getCell("F")));  // Date
                tr.appendChild(createTd(getCell("G")));  // Comments

                // Website Column (separate) - THE KEY ADDITION
                const websiteTd = document.createElement("td");
                if (colIndexH !== undefined && row.c[colIndexH] && row.c[colIndexH].v && row.c[colIndexH].v.startsWith("http")) {
                    const a = document.createElement("a");
                    a.href = row.c[colIndexH].v; // Raw URL
                    a.textContent = "Link";       // Display "Link" (or anything you want)
                    a.target = "_blank";
                    websiteTd.appendChild(a);
                } // No "else" needed - leave the cell empty if no link
                tr.appendChild(websiteTd);


                tr.appendChild(createTd(getCell("I")));  // Countdown
                tr.appendChild(createTd(getCell("J")));  // (for sorting)
                tableBody.appendChild(tr);
            });

            document.querySelector(".loading").style.display = "none";

        } catch (error) {
            console.error("Error fetching or parsing data:", error);
            document.querySelector(".loading").textContent = "Error loading conference data. Please try again later.";
        }
    }
	// Helper function to create table cells
	function createTd(content) {
		const td = document.createElement("td");
		td.textContent = content || ""; // Ensure content is not null/undefined
		return td;
	}

    // Handles the "/*O_o*/" prefix.
    function parseGoogleSheetsJSONP(text) {
        const jsonString = text.replace(/^\/\*O_o\*\/\s*/, '').replace(/google\.visualization\.Query\.setResponse\(|\);/g, "");
        return JSON.parse(jsonString);
    }

    fetchAndDisplayConferences();
    </script>
</body>
</html>